---
- name: Set Postgres to start upon system boot
  service:
    name: postgresql
    enabled: yes
  # Don't bother with systemd in the Molecule Docker container. Just skip testing this task.
  tags: notest

- name: Initialize MSFDB
  shell: msfdb init && touch ~/.ansible-msfdb-init
  args:
    creates: ~/.ansible-msfdb-init
  # Don't bother with systemd in the Molecule Docker container.
  # Can't connect to Postgresl due to systemd in Docker. Not a big testing concern.
  tags: notest

- name: Create wordlists dir
  file:
    path: /usr/share/wordlists
    state: directory

- name: Un-archive Rockyou Wordlist
  unarchive:
    remote_src: yes
    src: /usr/share/seclists/Passwords/Leaked-Databases/rockyou.txt.tar.gz
    dest: /usr/share/wordlists

- name: Install Autorecon
  command: python3 -m pip install git+https://github.com/Tib3rius/AutoRecon.git
  args:
    creates: /usr/local/bin/autorecon

- name: Download PEDA
  git:
    repo: https://github.com/longld/peda.git
    dest: /peda
    version: master
    bare: yes

- name: Update PEDA file permissions
  file:
    path: /peda
    owner: kali
    group: kali
    recurse: yes
    state: directory

- name: Configure PEDA
  lineinfile:
    path: "{{ item }}/.gdbinit"
    line: source /peda/peda.py
    create: yes
    state: present
    regexp: ^source .*\/peda\.py$
  loop:
    - /root
    - /home/kali
